<?php

function webspeech_tts_menu() {
  $items = array();
  $items['node/%/webspeech_tts'] = array(
    'title' => t('Webspeech TTS for Chrome'),
    'description' => t('Option to Read Node Content Out Loud'),
    'type' => MENU_LOCAL_TASK,
    //http://drupal.stackexchange.com/questions/30357/why-do-i-get-these-errors-in-my-module
    'page callback' => 'drupal_get_form',
    'page arguments' => array('webspeech_tts_form'),
    'access callback' => TRUE,
  );

  $items['admin/config/content/webspeech_tts'] = array(
    'title' => t('Webspeech TTS for Chrome Settings'),
    'description' => t('Administer Webspeech TTS for Chrome'),
    'page callback' => 'drupal_get_form',
    'page arguments' => array('webspeech_tts_admin_settings_form'),
    'access arguments' => array('administer webspeech_tts'),
    'file' => 'webspeech_tts.admin.inc',
    'type' => MENU_NORMAL_ITEM,
    );
  return $items;
}

function webspeech_tts_permission() {
  return array(
    'administer webspeech_tts' => array(
      'title' => t('Administer webspeech_tts'),
      'description' => t('Change the settings for how Webspeech TTS behaves on the site.'),
    ),
  );
}

function webspeech_tts_form($form, &$form_state){


  $path_args = explode('/', current_path());  
  $node = node_load((int)$path_args[1]);
  $node_content_to_js = $node->body['und'][0]['value'];
  drupal_static_reset('sites/all/modules/custom/webspeech_tts/webspeech_tts.js');
  //http://drupal.stackexchange.com/questions/128243/drupal-add-js-settings-and-working-around-the-anonymous-page-cache
  //http://dominiquedecooman.com/blog/drupal-7-hook-implementations-are-cached-database  
  //drupal_set_message($node_content_to_js);
  drupal_add_js(array('webspeech_tts' => array('proof_of_concept' => $node_content_to_js)), 'setting');
  drupal_add_js('sites/all/modules/custom/webspeech_tts/webspeech_tts.js');

  print '<pre>';
 //var_dump(get_defined_vars());
  print '</pre>';


  $form['submit_button'] = array(
      '#type' => 'submit',
      '#value' => t('Read Text Aloud'),
      '#action' => url('#'),
      '#attributes' => array('onclick' => 'return (false);'),
  );

  return $form;
}


/**
 * Implements hook_form_alter().
 *
 */

/** From Acquia Documentation

function mailfish_form_node_form_alter(&$form, $form_state)
{  
$node = $form['#node'];  
$types = variable_get('mailfish_types', array());
    if (!empty($types[$node->type]) && user_access('administer
   mailfish settings')) {    
$form['mailfish'] = array(      
'#title' => t('Mailfish'),      
'#type' => 'fieldset',      
'#collapsible' => TRUE,      
'#collapsed' => FALSE,      
'#group' => 'additional_settings',    );    $form['mailfish']['mailfish_enabled'] = array(      '#title' => t('Collect e-mail addresses for this node.'),      
'#type' => 'checkbox',
'#default_value' => isset($node->mailfish_enabled) ?        $node->mailfish_enabled : FALSE,    );  }
}


**/

function webspeech_tts_form_node_form_alter(&$form, $form_state){
  $node = $form['#node'];
  $form['webspeech_tts_node_form'] = array(
      '#title' => t('Webspeech TTS'),
      '#type' => 'fieldset',      
      '#collapsible' => TRUE,      
      '#collapsed' => FALSE,
      '#group' => 'additional_settings', 
      );

  $form['webspeech_tts']['webspeech_tts'] = array(      
      '#title' => t('Check to activate Webspeech TTS'), 
      '#type' => 'checkbox',
      '#default_value' => isset($node->webspeech_tts_enabled) ? $node->webspeech_tts_enabled : FALSE,
      );
}




function webspeech_tts_node_view($node, $view_mode) {
    //drupal_set_message("You are viewing a node");
}


  